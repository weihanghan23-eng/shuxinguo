<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>词云测试页面</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        #wordcloud-container {
            width: 600px;
            height: 400px;
            border: 2px solid #ccc;
            margin: 20px auto;
            background: #f9f9f9;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>词云功能测试页面</h1>
        <p>这是一个独立的测试页面，用于验证词云功能是否正常工作。</p>
        
        <div id="status-container">
            <div id="echarts-status" class="status info">检查ECharts...</div>
            <div id="plugin-status" class="status info">检查词云插件...</div>
            <div id="chart-status" class="status info">初始化图表...</div>
        </div>
        
        <div id="wordcloud-container"></div>
        
        <div id="debug-info">
            <h3>调试信息：</h3>
            <div id="debug-content"></div>
        </div>
    </div>

    <!-- 引入ECharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts-wordcloud/2.1.0/echarts-wordcloud.min.js"></script>
    
    <script>
        // 状态更新函数
        function updateStatus(id, message, type) {
            const element = document.getElementById(id);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        // 调试信息函数
        function addDebugInfo(message) {
            const debugContent = document.getElementById('debug-content');
            const time = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<div>[${time}] ${message}</div>`;
        }
        
        // 检查ECharts
        function checkECharts() {
            if (typeof echarts === 'undefined') {
                updateStatus('echarts-status', '❌ ECharts 未加载', 'error');
                addDebugInfo('ECharts 未加载');
                return false;
            }
            
            updateStatus('echarts-status', '✅ ECharts 已加载', 'success');
            addDebugInfo('ECharts 加载成功');
            return true;
        }
        
        // 检查词云插件
        function checkWordcloudPlugin() {
            if (typeof echarts.registerTransform === 'undefined') {
                updateStatus('plugin-status', '❌ 词云插件未加载', 'error');
                addDebugInfo('词云插件未加载');
                return false;
            }
            
            updateStatus('plugin-status', '✅ 词云插件已加载', 'success');
            addDebugInfo('词云插件加载成功');
            return true;
        }
        
        // 初始化词云
        function initWordcloud() {
            try {
                const container = document.getElementById('wordcloud-container');
                
                if (!container) {
                    updateStatus('chart-status', '❌ 容器不存在', 'error');
                    addDebugInfo('词云容器不存在');
                    return;
                }
                
                addDebugInfo(`容器尺寸: ${container.offsetWidth} x ${container.offsetHeight}`);
                
                // 初始化图表
                const myChart = echarts.init(container);
                addDebugInfo('ECharts 实例创建成功');
                
                // 测试数据
                const wordData = [
                    { name: '测试', value: 100 },
                    { name: '词云', value: 80 },
                    { name: '显示', value: 60 },
                    { name: '成功', value: 40 }
                ];
                
                addDebugInfo(`测试数据准备完成: ${wordData.length} 个词`);
                
                // 配置选项
                const option = {
                    series: [{
                        type: 'wordCloud',
                        shape: 'circle',
                        sizeRange: [20, 100],
                        rotationRange: [0, 0],
                        gridSize: 8,
                        drawOutOfBound: false,
                        textStyle: {
                            fontWeight: 'bold',
                            color: '#01BAEF'
                        },
                        data: wordData
                    }]
                };
                
                addDebugInfo('开始设置配置...');
                myChart.setOption(option);
                addDebugInfo('配置设置完成');
                
                // 检查渲染结果
                setTimeout(() => {
                    const canvas = container.querySelector('canvas');
                    const svg = container.querySelector('svg');
                    
                    if (canvas) {
                        addDebugInfo(`✅ Canvas 渲染成功: ${canvas.width} x ${canvas.height}`);
                        updateStatus('chart-status', '✅ 词云渲染成功 (Canvas)', 'success');
                    } else if (svg) {
                        addDebugInfo(`✅ SVG 渲染成功`);
                        updateStatus('chart-status', '✅ 词云渲染成功 (SVG)', 'success');
                    } else {
                        addDebugInfo('❌ 未找到 Canvas 或 SVG 元素');
                        updateStatus('chart-status', '❌ 词云渲染失败', 'error');
                        
                        // 显示容器内容
                        addDebugInfo(`容器内容: ${container.innerHTML}`);
                    }
                }, 1000);
                
            } catch (error) {
                updateStatus('chart-status', `❌ 初始化失败: ${error.message}`, 'error');
                addDebugInfo(`错误: ${error.message}`);
                console.error('词云初始化失败:', error);
            }
        }
        
        // 主函数
        function main() {
            addDebugInfo('页面加载完成，开始检查...');
            
            // 等待资源加载
            setTimeout(() => {
                if (checkECharts() && checkWordcloudPlugin()) {
                    addDebugInfo('所有依赖检查通过，开始初始化词云...');
                    initWordcloud();
                } else {
                    addDebugInfo('依赖检查失败，无法初始化词云');
                }
            }, 500);
        }
        
        // 页面加载完成后执行
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', main);
        } else {
            main();
        }
    </script>
</body>
</html> 